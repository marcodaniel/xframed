%%=======================================================%%
%%=======================================================%%
%% xframed-titlefoot.def                                 %%
%%                                                       %%
%% file to define all functions to use title or foot     %%
%% file is part of the package xframed                   %%
%%                                                       %%
%% Author's name: Marco Daniel                           %%
%% License type: lppl                                    %%
%%                                                       %%
%%  Copyright (c) 2013 Marco Daniel                      %%
%%                                                       %%
%%  This package may be distributed under the terms      %%
%%  of the LaTeX Project Public License, as described    %%
%%  in lppl.txt in the base LaTeX distribution.Either    %%
%%  version 1.0 or, at your option, any later version.   %%
%%=======================================================%%
%%=======================================================%%


\cs_new:Nn \xframed__title:
 {
    \tl_if_blank:VTF \l__xframed_title_tl
     {
      \coffin_set_eq:NN \l__xframed_foot_coffin \c_empty_coffin
     } 
     {
      %ssave the contents of title in coffin
      \vcoffin_set:Nnn
          \l__xframed_title_coffin
        { \l__xframed_coffin_width_dim   }
        {
         \tl_use:N \l__xframed_titleprecode_tl
         \tl_use:N \l__xframed_title_font_tl
         \color { \xframed__get_color:n { title-font-color } }
         \tl_use:N \l__xframed_title_tl
         \xframed__ignore_last_descenders:
         \xframed__ignore_last_skip:
         \tl_use:N \l__xframed_titlepostcode_tl 
        }
      %add the needed vertical space to coffin    
      \vcoffin_set:Nnn   
          \l__xframed_title_coffin
        { \l__xframed_coffin_width_dim }
        {
         \skip_vertical:n {  \xframed__get_length:n { title-above-skip } - \parskip }
         \skip_vertical:n { - \parskip }
         \box_use:N \l__xframed_title_coffin
         \skip_vertical:n {  \xframed__get_length:n { title-below-skip } }
        }     
    }    
 } 

\cs_new:Nn \xframed__first_title:
 {
    \tl_if_blank:VTF \l__xframed_firsttitle_tl
     {
      \coffin_set_eq:NN \l__xframed_foot_coffin \c_empty_coffin
     } 
     {
      \vcoffin_set:Nnn
          \l__xframed_title_coffin
        { \l__xframed_coffin_width_dim   }
        {
         \tl_use:N \l__xframed_titleprecode_tl
         \tl_use:N \l__xframed_title_font_tl
         \color { \xframed__get_color:n { title-font-color } }
         \tl_use:N \l__xframed_firsttitle_tl
         \xframed__ignore_last_descenders:
         \xframed__ignore_last_skip:
         \tl_use:N \l__xframed_titlepostcode_tl 
        }
      %add the needed vertical space to coffin    
      \vcoffin_set:Nnn   
          \l__xframed_title_coffin
        { \l__xframed_coffin_width_dim }
        {
         \skip_vertical:n { \xframed__get_length:n { title-above-skip } - \parskip }
         %\skip_vertical:n { - \parskip }
         \box_use:N \l__xframed_title_coffin
         \skip_vertical:n { \xframed__get_length:n { title-below-skip } }
        }    
    }
 }



\cs_new:Nn \xframed__foot:
 {
    \tl_if_blank:VTF \l__xframed_foot_tl
     {
      \coffin_set_eq:NN \l__xframed_foot_coffin \c_empty_coffin
     } 
     {
      \vcoffin_set:Nnn
          \l__xframed_foot_coffin
        { \l__xframed_coffin_width_dim   }
        {
         \color { \xframed__get_color:n { foot-font-color } }
         \tl_use:N \l__xframed_footprecode_tl
         \tl_use:N \l__xframed_foot_font_tl
         \tl_use:N \l__xframed_foot_tl
         \xframed__ignore_last_descenders:
         \xframed__ignore_last_skip:
         \tl_use:N \l__xframed_footpostcode_tl 
        }
      %add the needed vertical space to coffin    
      \vcoffin_set:Nnn   
          \l__xframed_foot_coffin
        { \l__xframed_coffin_width_dim }
        {
         \skip_vertical:n {  \xframed__get_length:n { foot-above-skip } - \parskip }
         \box_use:N \l__xframed_foot_coffin
         \skip_vertical:n {  \xframed__get_length:n { foot-below-skip } }
        }    
    }
 }


\cs_new:Nn \xframed__last_foot:
 {
    \tl_if_blank:VTF \l__xframed_lastfoot_tl
     {
      \coffin_set_eq:NN \l__xframed_foot_coffin \c_empty_coffin
     } 
     {
      \vcoffin_set:Nnn
          \l__xframed_foot_coffin
        { \l__xframed_coffin_width_dim   }
        {
         \color { \xframed__get_color:n { foot-font-color } }
         \tl_use:N \l__xframed_footprecode_tl
         \tl_use:N \l__xframed_foot_font_tl
         \tl_use:N \l__xframed_lastfoot_tl
         \xframed__ignore_last_descenders:
         \xframed__ignore_last_skip:
         \tl_use:N \l__xframed_footpostcode_tl 
        }
      %add the needed vertical space to coffin    
      \vcoffin_set:Nnn   
          \l__xframed_foot_coffin
        { \l__xframed_coffin_width_dim }
        {
         \skip_vertical:n {  \xframed__get_length:n { foot-above-skip } - \parskip }
         \box_use:N \l__xframed_foot_coffin
         \skip_vertical:n {  \xframed__get_length:n { foot-below-skip } }
        }    
    }
 }
